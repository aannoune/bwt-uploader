<link rel="import" href="bwt-upload-behavior.html">
<dom-module id="bwt-image-preview">
  <template>
    <style is="custom-style">
    :host {
      display: block;
    }

    .template-div-droptext>span {
        text-align: center;
    }

    .template-div-droptext .template-span-button,.template-div-delete, iron-icon  {
      color: #1976d3;
      cursor: pointer;
    }

    .template-div-delete, .template-div-delete iron-icon{
      height: 42px;
      line-height: 43px;
      color: #9b9b9b;
    }

    .template-div-droptext span:nth-child(2){
      text-align: left;
      font-weight: 400;
    }

    .imageCircleContainer,.imageSquareContainer{
      order: 1;
      flex: wrap;
      border: 1px dashed #dbdbdb;
      overflow: hidden;
      width: 250px;
      height: 250px;
    }

    .largeImageContainer {
      height: 800px;
      width: 800px;
    }

    .img {
      height:inherit;
      width:inherit;
      display: block;
    }

    .imageCircleContainer {
      border-radius: 100%;
    }

    .imageCircleContainer>div {
      background-size:cover !important;
    }

    </style>
    <template is="dom-if" if="{{ _checkTheme(theme,'circle') }}">
      <div class="imageCircleContainer">
         <div class="img" style="background: url('[[image]]') no-repeat center center;"></div>
      </div>
    </template>
    <template is="dom-if" if="{{ _checkTheme(theme,'square') }}">
      <div class="imageSquareContainer">
         <div class="img" style="background: url('[[image]]') no-repeat left top;"></div>
      </div>
    </template>
  </template>
  <script>
    Polymer({
      is: 'bwt-image-preview',
      behaviors: [BwtUploadBehavior],
      observers: ['updateImage(placeholder,image)'],
      _checkTheme: function(theme,shape){
        return (theme === shape) ? true : false;
      },
      updateImage: function(placeholder,image){
        this.image = (placeholder && image) ? image : placeholder;
      },
      downSampleImage:function(file) {
        file.progress = 20;

        var fr = new FileReader();

        fr.onload = function(e) {
          var image = e.target.result;
          this.image = image;
          var canvas = document.createElement('canvas');
          canvas.setAttribute('height','800'); // need to add as an option
          canvas.setAttribute('width','800');

          this.createBase64Image(image)
             .then(function(img) {
               var resizedImage = ( img.height > canvas.height || img.width > canvas.width || file.size > 1000000 ) ? resizer.scaleImage(img,canvas) : image;
               return { image: resizedImage, sizes: [Math.max(img.height,img.width), 100 ] };
             }.bind(this));

        }.bind(this);

        fr.readAsDataURL(file);
      },
      createBase64Image: function(image){
        var img = new Image();
        img.src = image;
        return new Promise( function(resolve,reject) {
          img.onload = resolve(img);
        });
      }
    });
  </script>
</dom-module>
