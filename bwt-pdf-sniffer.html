<link rel="import" href="./bower_components/pdfjs-dist/build/pdf.worker.min.js">
<dom-module id="bwt-pdf-sniffer">
  <style>
    :host {
      display: none;
    }
  </style>
  <template>
      <canvas id="pdfcanvas"></canvas>
  </template>
  <script>
    Polymer({
      is: 'bwt-pdf-sniffer',
      properties: {
        image: {
          type:String,
          value: ''
        },
        file: {
          type:Array,
          observer: '_getDocumentPreview'
        }
      },
      _getDocumentPreview: function(file){
        PDFJS.getDocument(file).then(function (pdf) {
           pdf.getPage(1).then(function(page) {

              var scale = 1.5;
              var viewport = page.getViewport(scale);
              var canvas = document.getElementById('pdfcanvas');
              var context = canvas.getContext('2d');
              canvas.height = viewport.height;
              canvas.width = viewport.width;

              var task = page.render({canvasContext: context, viewport: viewport});

              task.promise.then(function(){
                this.image = canvas.toDataURL('image/jpeg');
              }.bind(this));
           }.bind(this))
        }.bind(this));
      }
    });
  </script>
</dom-module>
